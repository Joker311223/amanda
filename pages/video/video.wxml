<view class="page-container">
  <!-- è¯¾ç¨‹æ ‡é¢˜ -->
  <view class="course-header">
    <view class="course-title-card card">
      <view class="card-header">
        <text>ç¬¬{{courseNumber}}è¯¾ {{currentCourse.title}}</text>
      </view>
    </view>
  </view>

  <!-- è§†é¢‘æ’­æ”¾åŒºåŸŸ -->
  <view class="video-section">
    <view class="video-container">
      <!-- æ¨¡æ‹Ÿè§†é¢‘æ’­æ”¾å™¨ -->
      <view class="video-player">
        <!-- æœªå®Œæˆè¯¾ç¨‹ï¼šå¸¦è§¦æ‘¸å±‚æ§åˆ¶ -->
        <view
          wx:if="{{!isCourseCompleted && videoUrl}}"
          class="video-touch-layer"
          bindlongpress="onLongPressStart"
          bindtouchend="onLongPressEnd"
        >
          <video
            autoplay
            id='center'
            controls="{{true}}"
            enable-progress-gesture="{{true}}"
            show-fullscreen-btn="{{true}}"
            show-play-btn="{{true}}"
            show-center-play-btn="{{true}}"
            enable-play-gesture="{{true}}"
            show-progress="{{false}}"
            src="{{videoUrl}}"
            class="video-placeholder"
            bindended="onVideoEnded"
            bindfullscreenchange="onFullscreenChange"
            bindplay="onVideoPlay"
            bindpause="onVideoPause"
            bindtimeupdate="onVideoTimeUpdate"
            catchtap="toggleVideoPlay"
          />
          <!-- è‡ªå®šä¹‰æ§åˆ¶æŒ‰é’®ï¼ˆéå…¨å±æ—¶æ˜¾ç¤ºï¼‰ -->
         
        </view>

       
        <!-- å·²å®Œæˆè¯¾ç¨‹ï¼šå®Œæ•´æ§åˆ¶ -->
        <video
          wx:if="{{isCourseCompleted && videoUrl}}"
          autoplay
          id='center'
          controls="{{true}}"
          enable-progress-gesture="{{true}}"
          show-fullscreen-btn="{{true}}"
          show-play-btn="{{true}}"
          show-center-play-btn="{{true}}"
          show-progress="{{true}}"
          src="{{videoUrl}}"
          class="video-placeholder"
          bindended="onVideoEnded"
          bindfullscreenchange="onFullscreenChange"
        />
      </view>
    </view>

    <!-- ç¬”è®°åŠŸèƒ½ -->
    <view class="notes-section">
      <view class="notes-card card">
        <view class="card-header">
          <text>{{editingNoteId ? 'ç¼–è¾‘ç¬”è®°' : 'æ·»åŠ ç¬”è®°'}}</text>
        </view>
        <view class="card-content">
          <textarea
            class="notes-textarea"
            placeholder="è®°å½•ä½ çš„å­¦ä¹ å¿ƒå¾—å’Œæ„Ÿæ‚Ÿ..."
            value="{{notes}}"
            bindinput="onNotesInput"
            maxlength="500"
          ></textarea>
          <view class="notes-footer">
            <text class="char-count">{{notes.length}}/500</text>
            <view class="notes-actions">
              <button wx:if="{{editingNoteId}}" class="btn btn-secondary cancel-btn" bindtap="cancelEdit">
                å–æ¶ˆ
              </button>
              <button class="btn btn-primary save-notes-btn" bindtap="saveNotes">
                {{editingNoteId ? 'æ›´æ–°ç¬”è®°' : 'ä¿å­˜ç¬”è®°'}}
              </button>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç¬”è®°åˆ—è¡¨ -->
    <view class="notes-list-section" wx:if="{{courseNotesList.length > 0}}">
      <view class="notes-list-header">
        <text class="notes-count">å…± {{courseNotesList.length}} æ¡ç¬”è®°</text>
      </view>
      <view class="notes-list">
        <view class="note-item card" wx:for="{{courseNotesList}}" wx:key="id">
          <view class="note-content">
            <text class="note-text">{{item.content}}</text>
          </view>
          <view class="note-footer">
            <text class="note-time">{{item.updateTime}}</text>
            <view class="note-actions">
              <button class="btn-icon edit-btn" bindtap="editNote" data-id="{{item.id}}">
                <text>âœï¸ ç¼–è¾‘</text>
              </button>
              <button class="btn-icon delete-btn" bindtap="deleteNote" data-id="{{item.id}}">
                <text>ğŸ—‘ï¸ åˆ é™¤</text>
              </button>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å®Œæˆå­¦ä¹ æŒ‰é’® -->
    <view class="complete-section" wx:if="{{!isCourseCompleted}}">
      <button
        class="btn btn-primary complete-btn"
        bindtap="completeCourse"
        disabled="{{!isFinied}}"
      >
        {{!isFinied? 'è¯·å®Œæ•´è§‚çœ‹è§†é¢‘' : 'å®Œæˆå­¦ä¹ '}}
      </button>
    </view>
  </view>

  <!-- å®Œæˆå¼¹çª— -->
  <view class="completion-modal" wx:if="{{showExperienceGain}}" bindtap="continueJourney">
    <view class="modal-content" catchtap="stopPropagation">
      <!-- å†°æ·‡æ·‹æ’å›¾ -->
      <view class="celebration-icon">
        <view class="ice-cream">
          <view class="ice-cream-cone">
            <view class="cone-face">
              <view class="cone-eye left">â€¢</view>
              <view class="cone-eye right">â€¢</view>
              <view class="cone-mouth">á´—</view>
            </view>
          </view>
          <view class="ice-cream-scoops">
            <view class="scoop yellow"></view>
            <view class="scoop blue"></view>
            <view class="scoop orange"></view>
          </view>
        </view>
        <!-- è£…é¥°å…ƒç´  -->
        <view class="decoration-particles">
          <view class="particle star" style="top: 20rpx; left: 80rpx; color: #FFD700;">âœ¦</view>
          <view class="particle star" style="top: 60rpx; right: 100rpx; color: #7ed321;">âœ¦</view>
          <view class="particle circle" style="top: 100rpx; left: 60rpx; background: #FF6B6B;"></view>
          <view class="particle circle" style="top: 40rpx; right: 80rpx; background: #4ECDC4;"></view>
          <view class="particle plus" style="bottom: 120rpx; left: 100rpx; color: #FFD700;">+</view>
          <view class="particle plus" style="bottom: 140rpx; right: 120rpx; color: #FF6B6B;">+</view>
          <view class="particle dot" style="top: 80rpx; left: 120rpx; background: #7ed321;"></view>
          <view class="particle dot" style="bottom: 160rpx; right: 100rpx; background: #FFD700;"></view>
        </view>
      </view>

      <!-- åˆ†æ•°æ˜¾ç¤º -->
      <view class="points-display">
        <text class="points-number">{{currentCourse.experience || 30}}</text>
        <text class="points-unit">åˆ†</text>
      </view>

      <!-- æç¤ºæ–‡å­— -->
      <view class="completion-message">
        <text>æ­å–œä½ æˆåŠŸè§£é”{{currentCourse.experience || 30}}åˆ†ç»éªŒ</text>
      </view>

      <!-- ç»§ç»­æŒ‰é’® -->
      <button class="continue-btn" bindtap="continueJourney">ç»§ç»­</button>
    </view>
  </view>
</view>
