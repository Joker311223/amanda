<view class="page-container">
  <!-- é¡¶éƒ¨è¿”å› -->
  <view class="header">
    <button class="back-btn" bindtap="goBack">
      <text class="back-icon">â†</text>
      è¿”å›
    </button>
    <text class="header-title">å¿«ä¹åˆ†å…‘æ¢</text>
    <view class="header-spacer"></view>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view class="content">
    <!-- å½“å‰å¿«ä¹åˆ†æ˜¾ç¤º -->
    <view class="current-happiness-card">
      <view class="card-header">
        <text class="card-icon">ğŸ˜Š</text>
        <text class="card-title">å½“å‰å¿«ä¹åˆ†</text>
      </view>
      <view class="happiness-display">
        <text class="happiness-number">{{currentHappiness}}</text>
        <text class="happiness-unit">åˆ†</text>
      </view>
    </view>

    <!-- å¯ç”¨ç»éªŒå€¼æ˜¾ç¤º -->
    <view class="available-experience-card">
      <view class="card-header">
        <text class="card-icon">â­</text>
        <text class="card-title">å¯ç”¨ç§¯åˆ†</text>
      </view>
      <view class="experience-display">
        <text class="experience-number">{{totalExperience}}</text>
        <text class="experience-unit">åˆ†</text>
      </view>
      <view class="exchange-rate-info">
        <text>å…‘æ¢æ¯”ä¾‹ï¼š{{exchangeRate}} ç§¯åˆ† = 1 å¿«ä¹åˆ†</text>
      </view>
    </view>

    <!-- å…‘æ¢æ•°é‡é€‰æ‹© -->
    <view class="exchange-section">
      <view class="section-title">
        <text>é€‰æ‹©å…‘æ¢æ•°é‡</text>
        <text class="max-info">æœ€å¤šå¯å…‘æ¢ {{maxHappinessScore}} å¿«ä¹åˆ†</text>
      </view>

      <!-- æ»‘å—é€‰æ‹© -->
      <view class="slider-container">
        <view class="slider-labels">
          <text class="label-left">0</text>
          <text class="label-right">{{maxHappinessScore}}</text>
        </view>
        <slider
          class="happiness-slider"
          min="0"
          max="{{maxHappinessScore}}"
          step="1"
          value="{{selectedHappiness}}"
          bindchange="updateSelectedHappiness"
          activeColor="#667eea"
          backgroundColor="#e8eaf6"
          block-size="28"
          block-color="#667eea"
        />
        <view class="slider-value-display">
          <text class="selected-value">{{selectedHappiness}}</text>
          <text class="selected-unit">å¿«ä¹åˆ†</text>
        </view>
      </view>

      <!-- å¿«é€Ÿé€‰æ‹©æŒ‰é’® -->
      <view class="quick-select-buttons">
        <button class="quick-btn" bindtap="quickSelect" data-percentage="25">
          25%
        </button>
        <button class="quick-btn" bindtap="quickSelect" data-percentage="50">
          50%
        </button>
        <button class="quick-btn" bindtap="quickSelect" data-percentage="75">
          75%
        </button>
        <button class="quick-btn" bindtap="quickSelect" data-percentage="100">
          å…¨éƒ¨
        </button>
      </view>
    </view>

    <!-- å…‘æ¢é¢„è§ˆ -->
    <view class="exchange-preview">
      <view class="preview-item">
        <text class="preview-label">æ¶ˆè€—ç§¯åˆ†</text>
        <text class="preview-value">{{selectedHappiness * exchangeRate}}</text>
      </view>
      <view class="preview-arrow">â†’</view>
      <view class="preview-item">
        <text class="preview-label">è·å¾—å¿«ä¹åˆ†</text>
        <text class="preview-value">{{selectedHappiness}}</text>
      </view>
    </view>

    <!-- å…‘æ¢æŒ‰é’® -->
    <button class="exchange-btn" bindtap="performExchange">
      <text class="btn-icon">âœ¨</text>
      <text class="btn-text">ç«‹å³å…‘æ¢</text>
    </button>
  </view>

  <!-- å…‘æ¢åŠ¨ç”»å±‚ -->
  <view wx:if="{{showAnimation}}" class="animation-overlay">
    <view class="animation-container">
      <!-- åŠ¨ç”»å…ƒç´  -->
      <view class="exchange-animation" animation="{{animationData}}">
        <view class="animation-content">
          <text class="animation-icon">âœ¨</text>
          <text class="animation-text">{{selectedHappiness}}</text>
        </view>
      </view>

      <!-- ç²’å­æ•ˆæœ -->
      <view class="particles">
        <view class="particle" style="left: 20%; top: 30%;"></view>
        <view class="particle" style="left: 80%; top: 40%;"></view>
        <view class="particle" style="left: 30%; top: 70%;"></view>
        <view class="particle" style="left: 70%; top: 60%;"></view>
        <view class="particle" style="left: 50%; top: 20%;"></view>
        <view class="particle" style="left: 40%; top: 80%;"></view>
      </view>

      <!-- æˆåŠŸæç¤º -->
      <view wx:if="{{exchangeSuccess}}" class="success-message">
        <text class="success-icon">ğŸ‰</text>
        <text class="success-text">å…‘æ¢æˆåŠŸï¼</text>
      </view>
    </view>
  </view>
</view>
