<view class="assignment-page">
  <!-- å¤´éƒ¨ -->
  <view class="header">
    <view class="title">{{assignment.title}}</view>
    <view class="category">{{assignment.category}}</view>
  </view>

  <!-- å¯¼è¯­ -->
  <view wx:if="{{template}}" class="guide-section">
    <view class="guide-title">ğŸ“ å¯¼è¯­</view>
    <view class="guide-content">{{template.guide}}</view>
  </view>

  <!-- è¡¨å•å†…å®¹ -->
  <view wx:if="{{template && !completedData}}" class="form-section">
    <view wx:for="{{template.fields}}" wx:key="id" class="form-item">

      <!-- æ–‡æœ¬è¾“å…¥ -->
      <view wx:if="{{item.type === 'text'}}" class="field-group">
        <view class="field-label">{{item.label}}</view>
        <input
          class="field-input"
          placeholder="è¯·è¾“å…¥"
          value="{{formData[item.id]}}"
          data-field="{{item.id}}"
          bindinput="onFieldInput"
        />
      </view>

      <!-- æ•°å­—è¾“å…¥ -->
      <view wx:elif="{{item.type === 'number'}}" class="field-group">
        <view class="field-label">{{item.label}}</view>
        <input
          class="field-input"
          type="number"
          placeholder="{{item.min}}-{{item.max}}"
          value="{{formData[item.id]}}"
          data-field="{{item.id}}"
          bindinput="onFieldInput"
        />
      </view>

      <!-- æ–‡æœ¬åŸŸ -->
      <view wx:elif="{{item.type === 'textarea'}}" class="field-group">
        <view class="field-label">{{item.label}}</view>
        <textarea
          class="field-textarea"
          placeholder="è¯·è¯¦ç»†æè¿°..."
          value="{{formData[item.id]}}"
          data-field="{{item.id}}"
          bindinput="onFieldInput"
          maxlength="500"
        ></textarea>
      </view>

      <!-- å•é€‰æ¡† -->
      <view wx:elif="{{item.type === 'radio'}}" class="field-group">
        <view class="field-label">{{item.label}}</view>
        <radio-group
          class="radio-group"
          data-field="{{item.id}}"
          bindchange="onRadioChange"
        >
          <label wx:for="{{item.options}}" wx:key="*this" wx:for-item="option" class="radio-item">
            <radio value="{{option}}" checked="{{formData[item.id] === option}}"/>
            <text>{{option}}</text>
          </label>
        </radio-group>
      </view>

      <!-- å¤é€‰æ¡† -->
      <view wx:elif="{{item.type === 'checkbox'}}" class="field-group">
        <view class="field-label">{{item.label}}</view>
        <checkbox-group
          class="checkbox-group"
          data-field="{{item.id}}"
          bindchange="onCheckboxChange"
        >
          <label wx:for="{{item.options}}" wx:key="*this" wx:for-item="option" class="checkbox-item">
            <checkbox value="{{option}}" checked="{{formData[item.id].includes(option)}}"/>
            <text>{{option}}</text>
          </label>
        </checkbox-group>
      </view>

      <!-- å•é€‰+æ–‡æœ¬æ¡† -->
      <view wx:elif="{{item.type === 'radio-text'}}" class="field-group">
        <view class="field-label">{{item.label}}</view>
        <radio-group
          class="radio-group inline"
          data-field="{{item.id}}"
          data-type="radio"
          bindchange="onRadioTextChange"
        >
          <label wx:for="{{item.options}}" wx:key="*this" wx:for-item="option" class="radio-item">
            <radio value="{{option}}" checked="{{formData[item.id].radio === option}}"/>
            <text>{{option}}</text>
          </label>
        </radio-group>
        <view wx:if="{{formData[item.id].radio === 'æ˜¯'}}" class="sub-input">
          <input
            class="field-input"
            placeholder="{{item.textPlaceholder}}"
            value="{{formData[item.id].text}}"
            data-field="{{item.id}}"
            data-type="text"
            bindinput="onRadioTextChange"
          />
        </view>
      </view>

    </view>

    <!-- æäº¤æŒ‰é’® -->
    <view class="submit-section">
      <button
        class="submit-btn {{canSubmit ? 'active' : ''}}"
        bindtap="submitAssignment"
        disabled="{{!canSubmit}}"
      >
        æäº¤ä½œä¸š +30ç»éªŒå€¼
      </button>
    </view>
  </view>

  <!-- å·²å®Œæˆçš„ä½œä¸šå±•ç¤º -->
  <view wx:if="{{completedData}}" class="completed-section">
    <view class="completed-header">
      <text class="completed-icon">âœ…</text>
      <text class="completed-title">å·²å®Œæˆ</text>
    </view>
    <view class="completed-date">å®Œæˆæ—¶é—´ï¼š{{completedData.completionDate}}</view>

    <view class="completed-content">
      <view wx:for="{{template.fields}}" wx:key="id" class="completed-item">
        <view class="completed-label">{{item.label}}</view>
        <view class="completed-value">
          <!-- æ–‡æœ¬/æ•°å­—/æ–‡æœ¬åŸŸ -->
          <text wx:if="{{item.type === 'text' || item.type === 'number' || item.type === 'textarea'}}">
            {{completedData.formData[item.id] || 'æœªå¡«å†™'}}
          </text>

          <!-- å•é€‰ -->
          <text wx:elif="{{item.type === 'radio'}}">
            {{completedData.formData[item.id] || 'æœªé€‰æ‹©'}}
          </text>

          <!-- å¤é€‰ -->
          <view wx:elif="{{item.type === 'checkbox'}}">
            <text wx:for="{{completedData.formData[item.id]}}" wx:key="*this" wx:for-item="opt" class="checkbox-value">
              â€¢ {{opt}}
            </text>
            <text wx:if="{{!completedData.formData[item.id] || completedData.formData[item.id].length === 0}}">æœªé€‰æ‹©</text>
          </view>

          <!-- å•é€‰+æ–‡æœ¬ -->
          <view wx:elif="{{item.type === 'radio-text'}}">
            <text>{{completedData.formData[item.id].radio || 'æœªé€‰æ‹©'}}</text>
            <text wx:if="{{completedData.formData[item.id].text}}" class="sub-text">
              ï¼ˆ{{completedData.formData[item.id].text}}ï¼‰
            </text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ— æ¨¡æ¿æç¤º -->
  <view wx:if="{{!template}}" class="no-template">
    <view class="no-template-icon">ğŸ“‹</view>
    <view class="no-template-text">è¯¥ä½œä¸šæš‚æ— ç»ƒä¹ è¡¨å•</view>
    <view class="no-template-desc">è¯·è”ç³»ç®¡ç†å‘˜æ·»åŠ ä½œä¸šå†…å®¹</view>
  </view>
</view>
