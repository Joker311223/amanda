<view class="page-container">
  <!-- 引导内容 -->
  <view wx:if="{{currentStep === 'intro'}}" class="intro-container fade-in">
    <view class="card">
      <view class="card-header">
        <text>欢迎来到DBT技能随身练</text>
      </view>
      <view class="card-content">
        <view class="intro-text">
          <text class="greeting">Halo，你好！我是DBT小助手静静。</text>

          <text class="description">
            接下来8周，我会陪你学习实践辩证行为治疗（Dialectical Behavior Therapy）情绪管理技能，简称DBT。
          </text>

          <view class="dbt-intro">
            <text class="section-title">辩证行为疗法是什么？</text>
            <text class="section-content">
              DBT是一种认知行为疗法，旨在帮助人们调节情绪、改善人际关系，增强压力适应与自我接纳能力。
            </text>
          </view>

          <view class="skills-intro">
            <text class="section-title">以下是DBT的四个核心技能模块</text>

            <view class="skill-item">
              <text class="skill-title">正念技能：</text>
              <text class="skill-desc">DBT基础，锚定当下、觉察身心状态，培养不评判的接纳态度。</text>
            </view>

            <view class="skill-item">
              <text class="skill-title">情绪调节技能：</text>
              <text class="skill-desc">识别情绪信号与来源，掌握降低情绪强度、积累正面情绪的方法。</text>
            </view>

            <view class="skill-item">
              <text class="skill-title">痛苦耐受技能：</text>
              <text class="skill-desc">危机或痛苦中，用健康方式耐受不适，避免冲动行为。</text>
            </view>

            <view class="skill-item">
              <text class="skill-title">人际效能技能：</text>
              <text class="skill-desc">提升沟通质量与边界感，包括表达需求、合理拒绝、应对冲突。</text>
            </view>
          </view>
        </view>

        <button class="btn btn-primary" bindtap="nextStep">
          课程学习开始前，先来个快问快答吧！
        </button>
      </view>
    </view>
  </view>

  <!-- 用户信息收集 -->
  <view wx:if="{{currentStep === 'userInfo'}}" class="user-info-container fade-in">
    <view class="card">
      <view class="card-header">
        <text>完善资料</text>
      </view>
      <view class="card-content">
        <form bindsubmit="submitUserInfo">
          <view class="form-group">
            <text class="form-label">姓名</text>
            <input
              class="form-input {{errors.name ? 'input-error' : ''}}"
              name="name"
              placeholder="请输入您的姓名"
              value="{{userInfo.name}}"
              bindinput="onInputChange"
              bindblur="onInputBlur"
              data-field="name"
            />
            <text class="form-hint error-hint" wx:if="{{errors.name}}">
              ❌ {{errors.name}}
            </text>
          </view>

          <view class="form-group">
            <text class="form-label">性别</text>
            <view class="gender-selector {{errors.gender ? 'selector-error' : ''}}">
              <view
                class="gender-option {{userInfo.gender === 'male' ? 'selected' : ''}}"
                bindtap="selectGender"
                data-gender="male"
              >
                男
              </view>
              <view
                class="gender-option {{userInfo.gender === 'female' ? 'selected' : ''}}"
                bindtap="selectGender"
                data-gender="female"
              >
                女
              </view>
            </view>
            <text class="form-hint error-hint" wx:if="{{errors.gender}}">
              ❌ {{errors.gender}}
            </text>
          </view>

          <view class="form-group">
            <text class="form-label">出生年月</text>
            <picker
              mode="date"
              value="{{userInfo.birthDate}}"
              bindchange="onDateChange"
              fields="month"
            >
              <view class="form-input picker-input {{errors.birthDate ? 'input-error' : ''}}">
                {{userInfo.birthDate || '请选择出生年月'}}
              </view>
            </picker>
            <text class="form-hint error-hint" wx:if="{{errors.birthDate}}">
              ❌ {{errors.birthDate}}
            </text>
          </view>

          <view class="form-group">
            <text class="form-label">手机号</text>
            <input
              class="form-input {{errors.phone ? 'input-error' : ''}}"
              name="phone"
              type="text"
              placeholder="请输入11位手机号"
              value="{{userInfo.phone}}"
              bindinput="onInputChange"
              bindblur="onInputBlur"
              data-field="phone"
              maxlength="11"
            />
            <text class="form-hint error-hint" wx:if="{{errors.phone}}">
              ❌ {{errors.phone}}
            </text>
          </view>

          <view class="form-group">
            <text class="form-label">微信号</text>
            <input
              class="form-input {{errors.wechat ? 'input-error' : ''}}"
              name="wechat"
              placeholder="请输入微信号（6-20位）"
              value="{{userInfo.wechat}}"
              bindinput="onInputChange"
              bindblur="onInputBlur"
              data-field="wechat"
              maxlength="20"
            />
            <text class="form-hint error-hint" wx:if="{{errors.wechat}}">
              ❌ {{errors.wechat}}
            </text>
          </view>

          <button
            class="btn btn-primary start-journey-btn"
            form-type="submit"
            style="width:600rpx"
          >
            开始你的DBT技能学习之旅吧！
          </button>
        </form>

        <view class="contact-info">
          <text>有任何疑问请联系项目负责人杨老师 18888929709</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 注册成功弹窗 -->
  <view class="modal-overlay" wx:if="{{showSuccessModal}}" bindtap="closeSuccessModal">
    <view class="modal-content" catchtap>
      <view class="modal-header">
        <text class="modal-title">🎉 欢迎加入</text>
      </view>
      
      <view class="modal-body">
        <text class="welcome-text">亲爱的{{userInfo.name}}，</text>
        <text class="welcome-desc">欢迎加入DBT技能学习之旅！</text>
        
        <view class="contact-section">
          <text class="section-title">📞 联系方式</text>
          <view class="contact-item">
            <text class="contact-label">项目负责人：</text>
            <text class="contact-value">杨老师</text>
          </view>
          <view class="contact-item">
            <text class="contact-label">电话：</text>
            <text class="contact-value">18888929709</text>
          </view>
        </view>

        <view class="group-section">
          <text class="section-title">👥 学习交流群</text>
          <text class="group-desc">请添加杨老师微信，入学习交流群，与其他学员一起学习和交流。</text>
        </view>
      </view>

      <view class="modal-footer">
        <button class="btn btn-primary" bindtap="closeSuccessModal">
          开始学习
        </button>
      </view>
    </view>
  </view>
</view>
