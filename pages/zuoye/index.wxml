<view class="page-container">
  <!-- å¯¼è¯­ç•Œé¢ -->
  <view class="lead-screen {{isStarting ? 'fade-out' : ''}}" wx:if="{{showLeadScreen}}">
    <!-- å®Œæˆæ ‡å¿— -->
    <view class="completion-badge" wx:if="{{isAssignmentCompleted}}">
      <text class="completion-icon">âœ“</text>
      <text class="completion-text">å·²å®Œæˆ</text>
    </view>

    <view class="lead-content">
      <!-- è£…é¥°å›¾æ ‡ -->
      <view class="lead-icon">
        <view class="icon-circle">
          <text class="icon-emoji">ğŸ“</text>
        </view>
        <!-- è£…é¥°ç²’å­ -->
        <view class="lead-particles">
          <view class="lead-particle" style="top: 20rpx; left: 60rpx; background: #FFD700;"></view>
          <view class="lead-particle" style="top: 80rpx; right: 80rpx; background: #7ed321;"></view>
          <view class="lead-particle" style="bottom: 100rpx; left: 80rpx; background: #FF6B6B;"></view>
          <view class="lead-particle" style="bottom: 60rpx; right: 60rpx; background: #4ECDC4;"></view>
        </view>
      </view>

      <!-- å¯¼è¯­æ–‡æœ¬ -->
      <view class="lead-text-wrapper">
        <text class="lead-text">{{assignment.lead}}</text>
      </view>

      <!-- å¼€å§‹æŒ‰é’® -->
      <button class="start-btn" bindtap="onStartQuiz">å¼€å§‹ç­”é¢˜</button>
    </view>
  </view>

  <!-- è¿›åº¦æ¡åŒºåŸŸ -->
  <view class="progress-section" wx:if="{{!showLeadScreen}}">
    <!-- å®Œæˆæ ‡å¿— -->
    <view class="completion-badge" wx:if="{{isAssignmentCompleted}}">
      <text class="completion-icon">âœ“</text>
      <text class="completion-text">å·²å®Œæˆ</text>
    </view>

    <view class="progress-header">
      <text class="progress-label">é—®é¢˜</text>
      <text class="progress-count-big">{{currentQuestion + 1}}</text>
      <text class="progress-count">/{{totalQuestions}}</text>
    </view>
    <view class="progress-bar-wrapper">
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{progressPercent}}%"></view>
      </view>
      <view class="progress-indicator" style="left: {{progressPercent}}%">
        <view class="indicator-dot"></view>
      </view>
    </view>
  </view>
  <!-- é—®é¢˜å†…å®¹åŒºåŸŸ -->
  <view class="question-section" wx:if="{{!showLeadScreen}}">
    <text class="question-text">{{currentProblem.info}}</text>
  </view>
  <view class="form-container" wx:if="{{!showLeadScreen}}">
    <!-- 1. æ–‡æœ¬è¾“å…¥ç±» (type: "text") -->
    <block wx:if="{{currentProblem.type === 'text'}}">
      <view class="input-section">
        <view class="input-card">
          <view class="input-header">
            <text class="input-label">è¯·è¾“å…¥</text>
          </view>
          <textarea class="input-textarea" placeholder="{{currentProblem.placeholder}}" placeholder-style="color: #ffffff;" value="{{answer}}" bindinput="onInputChange" maxlength="500" auto-height />
        </view>
      </view>
    </block>
    <!-- 2. å•é€‰ç±» (type: "choose") -->
    <block wx:elif="{{currentProblem.type === 'choose'}}">
      <view class="input-section">
        <view class="input-card choice-card">
          <radio-group bindchange="onRadioChange">
            <label
              wx:for="{{currentProblem.options}}"
              wx:key="index"
              class="radio-item {{answer === item ? 'selected' : ''}}"
              data-value="{{item}}"
              bindtap="onOptionTap"
            >
              <radio value="{{item}}" checked="{{answer === item}}" />
              <view class="option-label">{{optionLabels[index]}}</view>
              <view class="option-content">
                <text class="option-title">{{item.title || item}}</text>
                <text class="option-text" wx:if="{{item.subtitle}}">{{item.subtitle}}</text>
              </view>
              <text class="check-icon" wx:if="{{answer === item}}">âœ“</text>
            </label>
          </radio-group>
        </view>
      </view>
    </block>
    <!-- 3. å¤šé€‰ç±» (type: "multiple") -->
    <block wx:elif="{{currentProblem.type === 'multiple'}}">
      <view class="input-section">
        <view class="input-card choice-card">
          <checkbox-group bindchange="onCheckboxChange">
            <label
              wx:for="{{currentProblem.options}}"
              wx:key="index"
              class="checkbox-item {{item.selected ? 'selected' : ''}}"
              data-value="{{item}}"
              data-index="{{index}}"
              bindtap="onCheckboxTap"
            >
              <checkbox value="{{item}}" checked="{{item.selected}}" />
              <view class="option-label">{{optionLabels[index]}}</view>
              <view class="option-content">
                <text class="option-title">{{item.title || item}}</text>
                <text class="option-text" wx:if="{{item.subtitle}}">{{item.subtitle}}</text>
              </view>
              <text class="check-icon" wx:if="{{item.selected}}">âœ“</text>
            </label>
          </checkbox-group>
        </view>
      </view>
    </block>
    <!-- 4. è¯„åˆ†ç±» (type: "score") -->
    <block wx:elif="{{currentProblem.type === 'score'}}">
      <view class="input-section">
        <view class="score-section">
          <!-- è¯„åˆ†å¡ç‰‡ -->
          <view class="score-card">
            <!-- é¡¶éƒ¨ï¼šè¿›åº¦æ¡å’Œæ•°å€¼ -->
            <view class="score-header">
              <view class="score-value-display">
                <text class="score-value-number">{{answer}}</text>
                <text class="score-value-unit">åˆ†</text>
              </view>
              <view class="score-progress">
                <view class="score-progress-bar">
                  <view class="score-progress-fill" style="width: {{(answer / (currentProblem.max || 100)) * 100}}%"></view>
                </view>
                <view class="score-progress-labels">
                  <text class="score-label-left">{{currentProblem.min || 0}}</text>
                  <text class="score-label-right">{{currentProblem.max || 100}}</text>
                </view>
              </view>
            </view>

            <!-- ä¸­éƒ¨ï¼šæ»‘å— -->
            <view class="score-slider-wrapper">
              <slider
                class="score-slider"
                value="{{answer}}"
                min="{{currentProblem.min || 0}}"
                max="{{currentProblem.max || 100}}"
                step="{{currentProblem.step || 10}}"
                bindchange="onSliderChange"
                bindchanging="onSliderChanging"
                activeColor="#58cc02"
                backgroundColor="#e5f5e0"
                block-size="32"
                block-color="#ffffff"
              />
            </view>

            <!-- åº•éƒ¨ï¼šè¯„åˆ†é€‰é¡¹ -->
            <view class="score-options" wx:if="{{currentProblem.options}}">
              <text wx:for="{{currentProblem.options}}" wx:key="index" class="score-option">
                {{item}}
              </text>
            </view>
          </view>
        </view>
      </view>
    </block>
    <!-- 5. æœªçŸ¥ç±»å‹ -->
    <block wx:else>
      <view class="input-section">
        <view class="input-card">
          <text class="error-text">æœªçŸ¥é—®é¢˜ç±»å‹: {{currentProblem.type}}</text>
        </view>
      </view>
    </block>
  </view>
  <!-- åº•éƒ¨æŒ‰é’® -->
  <view class="bottom-actions" wx:if="{{!showLeadScreen}}">
    <button class="prev-btn {{currentQuestion === 0 ? 'disabled' : ''}}" bindtap="onPreviousQuestion" disabled="{{currentQuestion === 0}}">ä¸Šä¸€é¢˜</button>
    <button class="next-btn" bindtap="onNextQuestion">ä¸‹ä¸€é¢˜</button>
  </view>

  <!-- å®Œæˆå¼¹çª— -->
  <view class="completion-modal" wx:if="{{showCompletionModal}}" bindtap="onCloseCompletionModal">
    <view class="modal-content" catchtap="stopPropagation">
      <!-- å†°æ·‡æ·‹æ’å›¾ -->
      <view class="celebration-icon">
        <view class="ice-cream">
          <view class="ice-cream-cone">
            <view class="cone-face">
              <view class="cone-eye left">â€¢</view>
              <view class="cone-eye right">â€¢</view>
              <view class="cone-mouth">á´—</view>
            </view>
          </view>
          <view class="ice-cream-scoops">
            <view class="scoop yellow"></view>
            <view class="scoop blue"></view>
            <view class="scoop orange"></view>
          </view>
        </view>
        <!-- è£…é¥°å…ƒç´  -->
        <view class="decoration-particles">
          <view class="particle star" style="top: 20rpx; left: 80rpx; color: #FFD700;">âœ¦</view>
          <view class="particle star" style="top: 60rpx; right: 100rpx; color: #7ed321;">âœ¦</view>
          <view class="particle circle" style="top: 100rpx; left: 60rpx; background: #FF6B6B;"></view>
          <view class="particle circle" style="top: 40rpx; right: 80rpx; background: #4ECDC4;"></view>
          <view class="particle plus" style="bottom: 120rpx; left: 100rpx; color: #FFD700;">+</view>
          <view class="particle plus" style="bottom: 140rpx; right: 120rpx; color: #FF6B6B;">+</view>
          <view class="particle dot" style="top: 80rpx; left: 120rpx; background: #7ed321;"></view>
          <view class="particle dot" style="bottom: 160rpx; right: 100rpx; background: #FFD700;"></view>
        </view>
      </view>

      <!-- åˆ†æ•°æ˜¾ç¤º -->
      <view class="points-display">
        <text class="points-number">{{earnedPoints}}</text>
        <text class="points-unit">åˆ†</text>
      </view>

      <!-- æç¤ºæ–‡å­— -->
      <view class="completion-message">
        <text>æ­å–œä½ æˆåŠŸè§£é”{{earnedPoints}}åˆ†ç»éªŒ</text>
      </view>

      <!-- ç»§ç»­æŒ‰é’® -->
      <button class="continue-btn" bindtap="onContinue">ç»§ç»­</button>
    </view>
  </view>
</view>