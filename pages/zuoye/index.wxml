<view class="page-container">
  <!-- ÂØºËØ≠ÁïåÈù¢ -->
  <view class="lead-screen {{isStarting ? 'fade-out' : ''}}" wx:if="{{showLeadScreen}}">
    <view class="lead-content">
      <!-- Ë£ÖÈ•∞ÂõæÊ†á -->
      <view class="lead-icon">
        <view class="icon-circle">
          <text class="icon-emoji">üìù</text>
        </view>
        <!-- Ë£ÖÈ•∞Á≤íÂ≠ê -->
        <view class="lead-particles">
          <view class="lead-particle" style="top: 20rpx; left: 60rpx; background: #FFD700;"></view>
          <view class="lead-particle" style="top: 80rpx; right: 80rpx; background: #7ed321;"></view>
          <view class="lead-particle" style="bottom: 100rpx; left: 80rpx; background: #FF6B6B;"></view>
          <view class="lead-particle" style="bottom: 60rpx; right: 60rpx; background: #4ECDC4;"></view>
        </view>
      </view>

      <!-- ÂØºËØ≠ÊñáÊú¨ -->
      <view class="lead-text-wrapper">
        <text class="lead-text">{{assignment.lead}}</text>
      </view>

      <!-- ÂºÄÂßãÊåâÈíÆ -->
      <button class="start-btn" bindtap="onStartQuiz">ÂºÄÂßãÁ≠îÈ¢ò</button>
    </view>
  </view>

  <!-- ËøõÂ∫¶Êù°Âå∫Âüü -->
  <view class="progress-section" wx:if="{{!showLeadScreen}}">
    <view class="progress-header">
      <text class="progress-label">ÈóÆÈ¢ò</text>
      <text class="progress-count-big">{{currentQuestion + 1}}</text>
      <text class="progress-count">/{{totalQuestions}}</text>
    </view>
    <view class="progress-bar-wrapper">
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{progressPercent}}%"></view>
      </view>
      <view class="progress-indicator" style="left: {{progressPercent}}%">
        <view class="indicator-dot"></view>
      </view>
    </view>
  </view>
  <!-- ÈóÆÈ¢òÂÜÖÂÆπÂå∫Âüü -->
  <view class="question-section" wx:if="{{!showLeadScreen}}">
    <text class="question-text">{{currentProblem.info}}</text>
  </view>
  <view class="form-container" wx:if="{{!showLeadScreen}}">
    <!-- 1. ÊñáÊú¨ËæìÂÖ•Á±ª (type: "text") -->
    <block wx:if="{{currentProblem.type === 'text'}}">
      <view class="input-section">
        <view class="input-card">
          <view class="input-header">
            <text class="input-label">ËØ∑ËæìÂÖ•</text>
          </view>
          <textarea class="input-textarea" placeholder="ËØ∑Âú®Ê≠§ËæìÂÖ•ÂÜÖÂÆπ" placeholder-style="color: #ffffff;" value="{{answer}}" bindinput="onInputChange" maxlength="500" auto-height />
        </view>
      </view>
    </block>
    <!-- 2. ÂçïÈÄâÁ±ª (type: "choose") -->
    <block wx:elif="{{currentProblem.type === 'choose'}}">
      <view class="input-section">
        <view class="input-card choice-card">
          <radio-group bindchange="onRadioChange">
            <label
              wx:for="{{currentProblem.options}}"
              wx:key="index"
              class="radio-item {{answer === item ? 'selected' : ''}}"
              data-value="{{item}}"
              bindtap="onOptionTap"
            >
              <radio value="{{item}}" checked="{{answer === item}}" />
              <view class="option-label">{{optionLabels[index]}}</view>
              <view class="option-content">
                <text class="option-title">{{item.title || item}}</text>
                <text class="option-text" wx:if="{{item.subtitle}}">{{item.subtitle}}</text>
              </view>
              <text class="check-icon" wx:if="{{answer === item}}">‚úì</text>
            </label>
          </radio-group>
        </view>
      </view>
    </block>
    <!-- 3. Â§öÈÄâÁ±ª (type: "multiple") -->
    <block wx:elif="{{currentProblem.type === 'multiple'}}">
      <view class="input-section">
        <view class="input-card choice-card">
          <checkbox-group bindchange="onCheckboxChange">
            <label
              wx:for="{{currentProblem.options}}"
              wx:key="index"
              class="checkbox-item {{item.selected ? 'selected' : ''}}"
              data-value="{{item}}"
              data-index="{{index}}"
              bindtap="onCheckboxTap"
            >
              <checkbox value="{{item}}" checked="{{item.selected}}" />
              <view class="option-label">{{optionLabels[index]}}</view>
              <view class="option-content">
                <text class="option-title">{{item.title || item}}</text>
                <text class="option-text" wx:if="{{item.subtitle}}">{{item.subtitle}}</text>
              </view>
              <text class="check-icon" wx:if="{{item.selected}}">‚úì</text>
            </label>
          </checkbox-group>
        </view>
      </view>
    </block>
    <!-- 4. ËØÑÂàÜÁ±ª (type: "score") -->
    <block wx:elif="{{currentProblem.type === 'score'}}">
      <view class="input-section">
        <view class="score-section">
          <view class="slider-container">
            <view class="custom-slider">
              <text class="slider-label left">0</text>
              <view class="slider-track">
                <view
                  wx:for="{{sliderSegments}}"
                  wx:key="index"
                  class="slider-segment {{index < answer ? 'active' : ''}}"
                ></view>
              </view>
              <text class="slider-label right">100</text>
            </view>
          </view>

          <slider
            value="{{answer}}"
            min="{{currentProblem.min || 0}}"
            max="{{currentProblem.max || 100}}"
            step="{{currentProblem.step || 10}}"
            bindchange="onSliderChange"
            bindchanging="onSliderChanging"
            activeColor="#58cc02"
            backgroundColor="#e5f5e0"
            block-size="28"
            block-color="#58cc02"
          />

          <view class="slider-value">{{answer}}</view>

          <!-- ÂèØÈÄâÔºöÊòæÁ§∫ËØÑÂàÜÈÄâÈ°π -->
          <view class="score-options" wx:if="{{currentProblem.options}}">
            <text wx:for="{{currentProblem.options}}" wx:key="index" class="score-option">
              {{item}}
            </text>
          </view>
        </view>
      </view>
    </block>
    <!-- 5. Êú™Áü•Á±ªÂûã -->
    <block wx:else>
      <view class="input-section">
        <view class="input-card">
          <text class="error-text">Êú™Áü•ÈóÆÈ¢òÁ±ªÂûã: {{currentProblem.type}}</text>
        </view>
      </view>
    </block>
  </view>
  <!-- Â∫ïÈÉ®ÊåâÈíÆ -->
  <view class="bottom-actions" wx:if="{{!showLeadScreen}}">
    <button class="next-btn" bindtap="onNextQuestion">‰∏ã‰∏ÄÈ¢ò</button>
  </view>

  <!-- ÂÆåÊàêÂºπÁ™ó -->
  <view class="completion-modal" wx:if="{{showCompletionModal}}" bindtap="onCloseCompletionModal">
    <view class="modal-content" catchtap="stopPropagation">
      <!-- ÂÜ∞Ê∑áÊ∑ãÊèíÂõæ -->
      <view class="celebration-icon">
        <view class="ice-cream">
          <view class="ice-cream-cone">
            <view class="cone-face">
              <view class="cone-eye left">‚Ä¢</view>
              <view class="cone-eye right">‚Ä¢</view>
              <view class="cone-mouth">·¥ó</view>
            </view>
          </view>
          <view class="ice-cream-scoops">
            <view class="scoop yellow"></view>
            <view class="scoop blue"></view>
            <view class="scoop orange"></view>
          </view>
        </view>
        <!-- Ë£ÖÈ•∞ÂÖÉÁ¥† -->
        <view class="decoration-particles">
          <view class="particle star" style="top: 20rpx; left: 80rpx; color: #FFD700;">‚ú¶</view>
          <view class="particle star" style="top: 60rpx; right: 100rpx; color: #7ed321;">‚ú¶</view>
          <view class="particle circle" style="top: 100rpx; left: 60rpx; background: #FF6B6B;"></view>
          <view class="particle circle" style="top: 40rpx; right: 80rpx; background: #4ECDC4;"></view>
          <view class="particle plus" style="bottom: 120rpx; left: 100rpx; color: #FFD700;">+</view>
          <view class="particle plus" style="bottom: 140rpx; right: 120rpx; color: #FF6B6B;">+</view>
          <view class="particle dot" style="top: 80rpx; left: 120rpx; background: #7ed321;"></view>
          <view class="particle dot" style="bottom: 160rpx; right: 100rpx; background: #FFD700;"></view>
        </view>
      </view>

      <!-- ÂàÜÊï∞ÊòæÁ§∫ -->
      <view class="points-display">
        <text class="points-number">{{earnedPoints}}</text>
        <text class="points-unit">ÂàÜ</text>
      </view>

      <!-- ÊèêÁ§∫ÊñáÂ≠ó -->
      <view class="completion-message">
        <text>ÊÅ≠Âñú‰Ω†ÊàêÂäüËß£ÈîÅ{{earnedPoints}}ÂàÜÁªèÈ™å</text>
      </view>

      <!-- ÁªßÁª≠ÊåâÈíÆ -->
      <button class="continue-btn" bindtap="onContinue">ÁªßÁª≠</button>
    </view>
  </view>
</view>