<view class="page-container">
  <!-- 经验值显示 -->
  <view class="experience-badge">
    <text class="star">⭐</text>
    <text>{{totalExperience}}分</text>
  </view>

  <!-- 页面标题 -->
  <view class="page-header">
    <view class="header-card card">
      <view class="card-header">
        <text>技能工具箱</text>
      </view>
    </view>
  </view>

  <!-- 分类筛选 -->
  <view class="category-section">
    <scroll-view class="category-scroll" scroll-x="true">
      <view class="category-tabs">
        <view
          class="category-tab {{currentCategory === 'all' ? 'active' : ''}}"
          bindtap="setCategory"
          data-category="all"
        >
          全部 ({{skillCards.length}})
        </view>
        <view
          class="category-tab {{currentCategory === '情绪管理-生物社会理论' ? 'active' : ''}}"
          bindtap="setCategory"
          data-category="情绪管理-生物社会理论"
        >
          生物社会理论 (3)
        </view>
        <view
          class="category-tab {{currentCategory === '正念' ? 'active' : ''}}"
          bindtap="setCategory"
          data-category="正念"
        >
          正念 (4)
        </view>
        <view
          class="category-tab {{currentCategory === '痛苦耐受' ? 'active' : ''}}"
          bindtap="setCategory"
          data-category="痛苦耐受"
        >
          痛苦耐受 (13)
        </view>
        <view
          class="category-tab {{currentCategory === '情绪调节' ? 'active' : ''}}"
          bindtap="setCategory"
          data-category="情绪调节"
        >
          情绪调节 (3)
        </view>
        <view
          class="category-tab {{currentCategory === '人际效能' ? 'active' : ''}}"
          bindtap="setCategory"
          data-category="人际效能"
        >
          人际效能 (5)
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 技能卡片网格 -->
  <view class="cards-section">
    <view class="cards-grid">
      <view
        class="skill-card"
        wx:for="{{filteredCards}}"
        wx:key="id"
        bindtap="viewSkillCard"
        data-card-id="{{item.id}}"
      >
        <image class="skill-card-bg" src="/images/tool-icon-jineng.svg" mode="aspectFit"></image>
        <view class="skill-card-content">
          <text class="skill-card-title">{{item.title}}</text>
          <text class="skill-card-category">{{item.category}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view wx:if="{{filteredCards.length === 0}}" class="empty-state">
    <view class="empty-icon">🛠️</view>
    <text class="empty-text">暂无相关技能卡片</text>
  </view>

  <!-- 快捷入口 -->
  <view class="quick-entry-section">
    <view class="quick-entry-card card">
      <view class="card-header">
        <text>快捷工具</text>
      </view>
      <view class="card-content">
        <view class="quick-entries">
          <view class="quick-entry-item" bindtap="goToEmotion">
            <view class="quick-entry-icon emotion-icon">💭</view>
            <view class="quick-entry-info">
              <text class="quick-entry-title">我的笔记</text>
              <text class="quick-entry-desc">记录和追踪情绪变化</text>
            </view>
            <view class="quick-entry-arrow">></view>
          </view>

          <view class="quick-entry-item" bindtap="showComingSoon">
            <view class="quick-entry-icon practice-icon">🧘</view>
            <view class="quick-entry-info">
              <text class="quick-entry-title">冥想练习</text>
              <text class="quick-entry-desc">正念冥想指导练习</text>
            </view>
            <view class="quick-entry-arrow">></view>
          </view>

          <view class="quick-entry-item" bindtap="showComingSoon">
            <view class="quick-entry-icon breathing-icon">🌬️</view>
            <view class="quick-entry-info">
              <text class="quick-entry-title">呼吸练习</text>
              <text class="quick-entry-desc">调节情绪的呼吸技巧</text>
            </view>
            <view class="quick-entry-arrow">></view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 图片预览弹窗 -->
  <view class="image-preview-modal {{showImagePreview ? 'show' : ''}}" bindtap="closeImagePreview">
    <view class="preview-container" catchtap="preventTap">
      <!-- 关闭按钮 -->
      <view class="close-btn" bindtap="closeImagePreview">
        <text>✕</text>
      </view>

      <!-- 图片轮播 -->
      <swiper
        class="image-swiper"
        current="{{currentImageIndex}}"
        bindchange="onImageChange"
        indicator-dots="{{currentImages.length > 1}}"
        indicator-color="rgba(255, 255, 255, 0.5)"
        indicator-active-color="#ffffff"
      >
        <swiper-item wx:for="{{currentImages}}" wx:key="index">
          <view class="swiper-item-wrapper">
            <movable-area class="movable-area" scale-area>
              <movable-view
                class="movable-view"
                direction="all"
                scale
                scale-min="1"
                scale-max="3"
                scale-value="{{imageScale}}"
                bindscale="onImageScale"
                x="{{imageX}}"
                y="{{imageY}}"
                damping="50"
                friction="2"
                bindtap="onImageTap"
              >
                <image
                  class="preview-image"
                  src="{{item}}"
                  mode="aspectFit"
                  show-menu-by-longpress
                  bindload="onImageLoad"
                />
              </movable-view>
            </movable-area>
          </view>
        </swiper-item>
      </swiper>

      <!-- 图片计数器 -->
      <view class="image-counter" wx:if="{{currentImages.length > 1}}">
        <text>{{currentImageIndex + 1}} / {{currentImages.length}}</text>
      </view>
    </view>
  </view>
</view>
