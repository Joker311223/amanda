# 快乐分兑换系统功能说明

## 功能概述
实现了一个完整的快乐分兑换系统，当用户完成所有课程和作业后，会在底部显示提示条，提示用户可以使用积分兑换快乐分。

## 核心功能

### 1. 完成提示条（Router页面）
- **触发条件**：所有课程和作业都已完成
- **显示位置**：页面底部固定位置
- **内容**：
  - 显示当前可用的积分数量
  - 显示可兑换的快乐分数量（5积分 = 1快乐分）
  - 提供"去兑换"和"关闭"两个按钮

### 2. 快乐分兑换页面
新建页面：`pages/happiness-exchange/happiness-exchange`

#### 页面功能：
- **当前快乐分显示**：展示用户当前拥有的快乐分
- **可用积分显示**：展示可用于兑换的积分
- **兑换数量选择**：
  - 滑块选择（0-最大可兑换数量）
  - 快速选择按钮（25%、50%、75%、100%）
- **兑换预览**：实时显示消耗的积分和获得的快乐分
- **兑换动画**：绚丽的兑换动画效果

### 3. 兑换动画效果
- **第一阶段**（800ms）：
  - 元素缩放到0.5倍
  - 旋转360度
  - 创建视觉冲击效果

- **第二阶段**（600ms）：
  - 元素恢复到正常大小
  - 显示成功提示（🎉）
  - 粒子效果四散飞出

- **粒子效果**：
  - 6个粒子从中心向四周飞出
  - 逐渐消失的淡出效果
  - 增强视觉反馈

### 4. 数据更新
兑换完成后：
- 更新用户的快乐分数量
- 减少相应的积分
- 保存到本地存储
- 自动返回上一页

## 技术实现

### 数据结构
在 `app.js` 的 `learningProgress` 中添加：
```javascript
happinessScore: 0, // 快乐分
```

### 兑换比例
- 5 经验值 = 1 快乐分

### 动画实现
使用微信小程序的 `wx.createAnimation()` API 实现：
- 缩放动画
- 旋转动画
- 粒子飞出效果
- 淡入淡出效果

## 文件结构

```
pages/
├── router/
│   ├── index.js (修改：添加完成检测和兑换逻辑)
│   ├── index.wxml (修改：添加完成提示条)
│   └── index.wxss (修改：添加提示条样式)
└── happiness-exchange/
    ├── happiness-exchange.js (新建)
    ├── happiness-exchange.wxml (新建)
    ├── happiness-exchange.wxss (新建)
    └── happiness-exchange.json (新建)

app.js (修改：添加happinessScore字段)
```

## 使用流程

1. **完成所有课程和作业**
   - 用户完成所有14个课程
   - 用户完成所有配套作业

2. **显示完成提示条**
   - Router页面底部弹出提示条
   - 显示可用积分和可兑换快乐分

3. **点击"去兑换"**
   - 跳转到快乐分兑换页面
   - 显示当前快乐分和可用积分

4. **选择兑换数量**
   - 使用滑块或快速按钮选择
   - 实时预览兑换结果

5. **执行兑换**
   - 点击"立即兑换"按钮
   - 播放绚丽的兑换动画
   - 显示成功提示
   - 自动返回Router页面

## 样式特点

- **渐变背景**：紫色渐变（#667eea → #764ba2）
- **卡片设计**：圆角卡片，阴影效果
- **动画流畅**：所有过渡都使用ease-out/ease-in-out
- **响应式**：适配不同屏幕尺寸
- **交互友好**：按钮有active状态反馈

## 动画细节

### 完成提示条动画
- 从下方滑入（slideUp）
- 图标持续弹跳（bounce）

### 兑换页面动画
- 卡片从下向上滑入（slideInUp）
- 按钮闪烁效果（twinkle）

### 兑换动画
- 缩放+旋转组合
- 粒子四散飞出
- 成功图标旋转弹出

## 调试模式

在Router页面URL中添加 `?debug=true` 参数可以显示debug按钮：
- 清空所有学习记录
- 一键完成所有课程

这对测试完成提示条和兑换功能很有帮助。

## 注意事项

1. 兑换比例固定为 5:1（5积分 = 1快乐分）
2. 兑换后积分会被消耗，快乐分会增加
3. 所有数据都会保存到本地存储
4. 动画总时长约1.4秒（800ms + 600ms）
5. 兑换成功后自动返回，无需用户手动返回
